<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xsukax GPG/PGP Key Generator</title>
    <script src="https://unpkg.com/openpgp@5.10.2/dist/openpgp.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0d1117; --surface: #161b22; --border: #30363d; --text: #c9d1d9; --text-muted: #8b949e; --accent: #58a6ff; --success: #238636; --error: #da3633; --warning: #f85149; }
        [data-theme="light"] { --bg: #ffffff; --surface: #f6f8fa; --border: #d0d7de; --text: #24292f; --text-muted: #656d76; --accent: #0969da; --success: #1a7f37; --error: #d1242f; --warning: #bf8700; }
        body { font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace; background: var(--bg); color: var(--text); line-height: 1.5; transition: all 0.3s ease; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .title { font-size: 24px; font-weight: 700; color: var(--accent); }
        .subtitle { font-size: 14px; color: var(--text-muted); margin-top: 4px; }
        .theme-toggle { position: relative; width: 60px; height: 30px; background: var(--border); border-radius: 15px; cursor: pointer; transition: all 0.3s ease; }
        .theme-toggle::before { content: ''; position: absolute; top: 3px; left: 3px; width: 24px; height: 24px; background: var(--accent); border-radius: 50%; transition: transform 0.3s ease; }
        [data-theme="light"] .theme-toggle::before { transform: translateX(30px); }
        .terminal { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; margin-bottom: 20px; }
        .terminal-header { background: var(--border); padding: 12px 16px; font-size: 12px; color: var(--text-muted); border-bottom: 1px solid var(--border); }
        .terminal-body { padding: 24px; }
        .form-group { margin-bottom: 20px; }
        .label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--text); font-weight: 500; }
        .input { width: 100%; padding: 12px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: inherit; font-size: 14px; transition: all 0.2s ease; }
        .input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.1); }
        .checkbox-group { display: flex; align-items: center; margin-bottom: 20px; }
        .checkbox { width: 18px; height: 18px; margin-right: 12px; accent-color: var(--accent); }
        .btn { background: var(--accent); color: #ffffff; border: none; padding: 12px 24px; border-radius: 4px; font-family: inherit; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; width: 100%; }
        .btn:hover { background: #4493f8; transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        .btn:disabled { background: var(--border); color: var(--text-muted); cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--surface); color: var(--accent); border: 1px solid var(--border); margin-top: 12px; }
        .btn-secondary:hover { background: var(--border); }
        .export-section { display: none; margin-top: 24px; }
        .export-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
        .loading { display: none; text-align: center; margin: 20px 0; }
        .spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 50%; border-top-color: var(--accent); animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .message { padding: 12px 16px; border-radius: 4px; margin: 16px 0; font-size: 14px; }
        .message.success { background: rgba(35, 134, 54, 0.1); color: var(--success); border: 1px solid var(--success); }
        .message.error { background: rgba(218, 54, 51, 0.1); color: var(--error); border: 1px solid var(--error); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--surface); border: 1px solid var(--border); border-radius: 6px; max-width: 90%; max-height: 80%; overflow-y: auto; min-width: 400px; }
        .modal-header { background: var(--border); padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 16px; font-weight: 600; color: var(--text); }
        .close-btn { background: none; border: none; font-size: 18px; cursor: pointer; color: var(--text-muted); }
        .close-btn:hover { color: var(--error); }
        .modal-body { padding: 20px; }
        .key-output { background: var(--bg); border: 1px solid var(--border); border-radius: 4px; padding: 16px; margin: 16px 0; min-height: 200px; font-family: inherit; font-size: 12px; white-space: pre-wrap; word-break: break-all; color: var(--text); }
        .prompt { color: var(--accent); }
        .prompt::before { content: '$ '; }
        @media (max-width: 600px) { .container { padding: 12px; } .modal-content { min-width: 95%; } .export-grid { grid-template-columns: 1fr; } .header { flex-direction: column; gap: 16px; } }
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <div class="header">
            <div>
                <div class="title">xsukax GPG/PGP Key Generator</div>
                <div class="subtitle">Client-Side Professional GPG/PGP Key Generation</div>
            </div>
            <div class="theme-toggle" onclick="toggleTheme()"></div>
        </div>
        
        <div class="terminal">
            <div class="terminal-header">~/crypto/keygen</div>
            <div class="terminal-body">
                <div class="prompt">generate-keypair --interactive</div>
                
                <form id="keyForm">
                    <div class="form-group">
                        <label class="label" for="name">Full Name *</label>
                        <input type="text" id="name" class="input" required placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label class="label" for="email">Email Address *</label>
                        <input type="email" id="email" class="input" required placeholder="your@email.com">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="usePassphrase" class="checkbox">
                        <label class="label" for="usePassphrase">Enable passphrase protection</label>
                    </div>
                    
                    <div class="form-group" id="passphraseGroup" style="display: none;">
                        <label class="label" for="passphrase">Passphrase</label>
                        <input type="password" id="passphrase" class="input" placeholder="Enter secure passphrase">
                    </div>
                    
                    <button type="submit" class="btn" id="generateBtn">Execute Key Generation</button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Generating cryptographic key pair...</p>
                </div>
                
                <div class="message success" id="successMessage" style="display: none;">
                    ✓ Key pair generation completed successfully
                </div>
                
                <div class="export-section" id="exportSection">
                    <div class="prompt">export-keys --format=asc</div>
                    <div class="export-grid">
                        <button class="btn btn-secondary" onclick="exportPublicKey()">Export Public Key</button>
                        <button class="btn btn-secondary" onclick="exportPrivateKey()">Export Private Key</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="keyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Key Export</h3>
                <button class="close-btn" onclick="closeModal('keyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="key-output" id="keyOutput"></div>
                <button class="btn" onclick="downloadKey()">Download .asc File</button>
            </div>
        </div>
    </div>

    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">⚠ Error</h3>
                <button class="close-btn" onclick="closeModal('errorModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p id="errorMessage"></p>
                <button class="btn" onclick="closeModal('errorModal')" style="margin-top: 16px;">OK</button>
            </div>
        </div>
    </div>

    <script>
        let generatedKeys = null;
        let currentKeyType = null;
        let currentKeyData = null;

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        window.addEventListener('load', function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            
            if (typeof openpgp === 'undefined') {
                const generateBtn = document.getElementById('generateBtn');
                generateBtn.disabled = true;
                generateBtn.textContent = 'Library Load Error';
                generateBtn.style.background = 'var(--error)';
                
                setTimeout(() => {
                    showError('OpenPGP library failed to load. Check connection and refresh.');
                }, 1000);
            }
        });

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').style.display = 'block';
        }

        document.getElementById('usePassphrase').addEventListener('change', function() {
            const passphraseGroup = document.getElementById('passphraseGroup');
            passphraseGroup.style.display = this.checked ? 'block' : 'none';
            if (!this.checked) document.getElementById('passphrase').value = '';
        });

        document.getElementById('keyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const usePassphrase = document.getElementById('usePassphrase').checked;
            const passphrase = usePassphrase ? document.getElementById('passphrase').value : '';

            if (!name || !email) {
                showError('Missing required fields: name and email are mandatory');
                return;
            }

            if (usePassphrase && !passphrase) {
                showError('Passphrase required when protection is enabled');
                return;
            }

            await generateKeys(name, email, passphrase);
        });

        async function generateKeys(name, email, passphrase) {
            const generateBtn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const successMessage = document.getElementById('successMessage');
            const exportSection = document.getElementById('exportSection');

            try {
                if (typeof openpgp === 'undefined') {
                    throw new Error('OpenPGP library not available. Refresh and retry.');
                }

                generateBtn.disabled = true;
                generateBtn.textContent = 'Processing...';
                loading.style.display = 'block';
                successMessage.style.display = 'none';
                exportSection.style.display = 'none';

                const keyOptions = {
                    type: 'ecc',
                    curve: 'curve25519',
                    userIDs: [{ name: name, email: email }],
                    passphrase: passphrase || undefined,
                    format: 'armored'
                };

                generatedKeys = await openpgp.generateKey(keyOptions);

                loading.style.display = 'none';
                successMessage.style.display = 'block';
                exportSection.style.display = 'block';

            } catch (error) {
                console.error('Key generation failed:', error);
                showError(error.message || 'Key generation failed. Retry operation.');
                loading.style.display = 'none';
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Execute Key Generation';
            }
        }

        function exportPublicKey() {
            if (!generatedKeys) {
                showError('No keys available. Generate keys first.');
                return;
            }

            currentKeyType = 'public';
            currentKeyData = generatedKeys.publicKey;
            
            document.getElementById('modalTitle').textContent = 'Public Key (ASCII Armored)';
            document.getElementById('keyOutput').textContent = generatedKeys.publicKey;
            document.getElementById('keyModal').style.display = 'block';
        }

        function exportPrivateKey() {
            if (!generatedKeys) {
                showError('No keys available. Generate keys first.');
                return;
            }

            currentKeyType = 'private';
            currentKeyData = generatedKeys.privateKey;
            
            document.getElementById('modalTitle').textContent = 'Private Key (ASCII Armored)';
            document.getElementById('keyOutput').textContent = generatedKeys.privateKey;
            document.getElementById('keyModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function downloadKey() {
            if (!currentKeyData || !currentKeyType) {
                showError('No key data available for download.');
                return;
            }

            const email = document.getElementById('email').value.trim();
            const filename = `${email}_${currentKeyType}_key.asc`;
            
            const blob = new Blob([currentKeyData], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        ['keyModal', 'errorModal'].forEach(modalId => {
            document.getElementById(modalId).addEventListener('click', function(e) {
                if (e.target === this) closeModal(modalId);
            });
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal('keyModal');
                closeModal('errorModal');
            }
        });
    </script>
</body>
</html>